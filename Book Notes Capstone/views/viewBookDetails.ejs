<%- include('partials/header.ejs'); -%>
<%- include('partials/navbar.ejs'); -%>

<div class="hero-section note px-4 pb-5 mb-5 text-center book-detail" style="background-image: url('<%= book.cover_url %>');">
</div>

<div class="container py-5">
  <div class="card shadow book-card book-card--detail">
    <div class="row g-0 align-items-center">
      
      <div class="col-md-5">
        <img src="<%= book.cover_url %>" 
             alt="Book Cover" 
             class="img-fluid rounded-start book-cover">
      </div>

      <div class="col-md-7">
        <div class="card-body">
          <!-- Edit Toggle Button -->
          <div class="text-end mb-3">
            <button id="toggleEdit" class="btn btn-outline-secondary">
              <i class="bi bi-pencil"></i> Edit Book
            </button>
          </div>

          <!-- View Mode -->
          <div id="viewMode">
            <h2 class="fw-bold"><%= book.title %></h2>
            <h5 class="text-muted mb-3"><%= book.author %></h5>

            <div class="mb-3">
              <strong>Started:</strong> <%= formatDate(book.date_started) %><br>
              <strong>Finished:</strong> <%= book.date_finished ? formatDate(book.date_finished) : 'Not finished yet' %>
            </div>

            <div class="notes-section mb-3">
              <h6 class="fw-semibold">Notes:</h6>
              <p style="white-space: pre-line;">
                <%- book.note %>
              </p>
            </div>

            <div class="mb-3">
              <h6 class="fw-semibold">Rating:</h6>
              <div class="book-rating">
              <div class="stars">
                <% for (let star = 1; star <= 5; star++) { %>
                <div class="star-wrapper <%= book.rating >= star ? 'selected-full' : book.rating >= star - 0.5 ? 'selected-half' : '' %>" 
                   data-rating="<%= star %>">
                  <i class="<%= book.rating >= star ? 'fas fa-star full-star' : book.rating >= star - 0.5 ? 'fas fa-star-half-alt half-star' : 'far fa-star empty-star' %>"></i>
                </div>
                <% } %>
              </div>
              <span class="ms-2"><%= book.rating %></span>
              </div>
            </div>

            <a href="/" class="btn btn-outline-primary">‚Üê Back</a>
          </div>

          <!-- Edit Mode (Initially Hidden) -->
          <form id="editMode" action="/books/<%= book.id %>/update" method="POST" style="display: none;">
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input type="text" class="form-control" id="title" name="title" value="<%= book.title %>" required>
            </div>

            <div class="mb-3">
              <label for="author" class="form-label">Author</label>
              <input type="text" class="form-control" id="author" name="author" value="<%= book.author %>" required>
            </div>


            <div class="mb-3">
              <label for="date_started" class="form-label">Started Date</label>
              <input type="date" class="form-control" id="date_started" name="date_started" value="<%= new Date(book.date_started).toISOString().split('T')[0] %>">
            </div>

            <div class="mb-3">
              <label for="date_finished" class="form-label">Finished Date</label>
              <input type="date" class="form-control" id="date_finished" name="date_finished" 
                     value="<%= book.date_finished ? new Date(book.date_finished).toISOString().split('T')[0] : '' %>">
            </div>

            <div class="mb-3">
              <label for="note" class="form-label">Notes</label>
              <textarea class="form-control" id="note" name="note" rows="4"><%- book.note %></textarea>
            </div>

            <!-- <div class="mb-3">
              <label for="rating" class="form-label">Rating</label>
              <div class="book-rating edit-mode">
                <div class="stars">
                  <% for (let star = 1; star <= 5; star++) { %>
                    <div class="star-wrapper <%= book.rating >= star ? 'selected-full' : book.rating >= star - 0.5 ? 'selected-half' : '' %>" 
                         data-rating="<%= star %>">
                      <i class="<%= book.rating >= star ? 'fas fa-star full-star' : book.rating >= star - 0.5 ? 'fas fa-star-half-alt half-star' : 'far fa-star empty-star' %>"></i>
                    </div>
                  <% } %>
                </div>
                <input type="hidden" id="edit_rating" name="rating" value="<%= book.rating %>">
              </div>
              <div class="rating-feedback mt-2 text-muted"></div>
            </div> -->

            <div class="d-flex justify-content-between">
              <button type="button" id="cancelEdit" class="btn btn-outline-secondary">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('toggleEdit').addEventListener('click', function() {
    document.getElementById('viewMode').style.display = 'none';
    document.getElementById('editMode').style.display = 'block';
  });

  document.getElementById('cancelEdit').addEventListener('click', function() {
    document.getElementById('viewMode').style.display = 'block';
    document.getElementById('editMode').style.display = 'none';
  });

</script>

<%- include('partials/footer.ejs'); -%>